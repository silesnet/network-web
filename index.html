<!DOCTYPE html>
<html>
  <head>
    <title>SilesNet IS</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="css/app.css">
  </head>
  <body>
    <div id='app'></div>

    <script type="text/x-handlebars">
      <nav class="navbar navbar-default" role="navigation">
        <div class="container">
          <a class="navbar-brand" href="..">Home</a>
          <a class="navbar-brand" href="#/services">Služby</a>
          <a class="navbar-brand" href="http://localhost:9090">Přidej službu</a>
          {{#if session.hasManagerOrNetworkAdminRole}}
            <a class="navbar-brand" href="#/service-errors">Chyby</a>
          {{/if}}
          <a class="navbar-brand" href="#/changelog"><span class="small">Seznam změn</span></a>
          <div class="navbar-right navbar-brand">
            <span class='glyphicon glyphicon-user'></span>
            {{session.userName}}|{{session.userCountry}}
          </div>
        </div>
      </nav>
      <div class="content">
        <div class="container">
          {{outlet}}
          {{outlet 'modal'}}
          <div class="notifications top-right">
          {{#each flashes.queue as |flash|}}
            {{#flash-message flash=flash}}
              <p>{{flash.message}}</p>
            {{/flash-message}}
          {{/each}}
          </div>
        </div>
      </div>
    </script>

    <script type="text/x-handlebars" id="services">
      <div class="input-group">
        <span class="input-group-addon" title="Aktivní zákazníci">
            {{active-button name="isActive" value=isActiveFilter}}
        </span>
        {{input id="service_search" class="form-control autofocus" type="text" value=query placeholder="Customer or Agreement"}}
        <div class="input-group-btn">
          <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
        </div>
      </div>
      {{#if services}}
        <table class="table table-striped">
          <tbody>
          {{#each services as |service|}}
            <tr {{action 'editService' service}} class="clickable">
              <td>{{service.service_id}}</td>
              <td>{{service.customer_name}}</td>
              <td>{{service.service_name}}</td>
              <td>{{service.download}}/{{service.upload}} Mbps</td>
              <td>{{service.agreement}}</td>
              <td>{{service.street}}</td>
              <td>{{service.city}}</td>
              <!--<td>{{service.customer_info}}</td>-->
              <td>{{service.service_info}}</td>
              <!--<td>{{#link-to 'service' service.service_id}}Upravit{{/link-to}}</td>-->
            </tr>
          {{/each}}
          </tbody>
        </table>
      {{/if}}
    </script>

    <script type="text/x-handlebars" id="service">
      <h2>{{customerName}} {{if isDraft '(DRAFT)'}}
        {{#unless isDraft}}
          <a href="https://sis.silesnet.net/account/customer/view.html?customerId={{model.customer.id}}&action=showDetail" target="_blank"><i class="glyphicon glyphicon-user tiny"></i></a>
        {{/unless}}
        {{#link-to 'services'}}<i class="glyphicon glyphicon-step-backward tiny"></i>{{/link-to}}
        {{#if canAddDhcp}}
          <div class="btn-group pull-right service"><button class="btn btn-success" {{action 'openModal' 'formEditDhcp' model}}><span class="glyphicon glyphicon-plus"></span>&#160;DHCP</button></div>
        {{/if}}
        {{#if canAddPppoe}}
          <div class="btn-group pull-right service"><button class="btn btn-success" {{action 'addPppoe' model}}><span class="glyphicon glyphicon-plus"></span>&#160;PPPoE</button></div>
        {{/if}}
        {{#if canAddTodo}}
          <div class="btn-group pull-right service"><button class="btn btn-success" {{action 'openModal' 'formAddTodo' model}}><span class="glyphicon glyphicon-plus"></span>&#160;TODO</button></div>
        {{/if}}
        <br />
        <span class="small">
          {{customerAddress}}
          <a href="http://www.google.com/maps?q={{customerAddress}}&t=k" target="_blank"><i class="glyphicon glyphicon-map-marker"></i></a>
          &nbsp;{{customerEmail}}
          <a href="mailto:{{customerEmail}}"><i class="glyphicon glyphicon-envelope"></i></a>
          &nbsp;{{customerPhone}}
          <a href="#" {{action 'openModal' 'formEditSms' model}}><i class="glyphicon glyphicon-phone"></i></a>
        </span>
      </h2>
      <h3>{{model.service.id}} {{model.service.name}} {{model.service.download}}/{{model.service.upload}} Mbs, {{model.service.price}} {{serviceCurrency}}</h3>

      {{#if model.customer.connection_spot}}
        <p>{{model.customer.connection_spot}}</p>
      {{/if}}

      {{#if model.service.address}}
        <p>{{address model.service.address}}</p>
      {{/if}}

      <div class="row">
        <div class="col-md-6">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title pull-left">Detail</h3>
              {{#if canEdit}}
                <button class="btn btn-primary pull-right" {{action 'openModal' 'formEditService' model}}><span class="glyphicon glyphicon-edit"></span>&#160;Upravit</button>
              {{/if}}
              <div class="clearfix"></div>
            </div>
            <div class="panel-body">
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Stav:</strong></p></div>
                  <div class="col-sm-10">{{serviceStatus}}</div>
                </div>
                {{#unless isDraft}}
                  <div class="row">
                    <div class="col-sm-2"><p class="text-right"><strong>Období:</strong></p></div>
                    <div class="col-sm-10">{{servicePeriod.from}} &rarr; {{servicePeriod.to}}</div>
                  </div>
                {{/unless}}
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Zařízení:</strong></p></div>
                  <div class="col-sm-10">
                    {{#each model.service.data.devices as |device|}}
                      <div>{{device.name}} ({{device.owner}})</div>
                    {{/each}}
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Poznámky:</strong></p></div>
                  <div class="col-sm-10">{{model.service.info}}</div>
                </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        {{#if model.dhcp.port}}
          <div class="col-md-6">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title pull-left">DHCP</h3>
                {{#if canEditDhcp}}
                  <button class="btn btn-primary pull-right" {{action 'openModal' 'formEditDhcp' model}}><span class="glyphicon glyphicon-edit"></span>&#160;Upravit</button>
                  <button class="btn btn-danger pull-right btn-delete" {{action 'openModal' 'confirmDhcpRemoval' model}}><span class="glyphicon glyphicon-trash"></span>&#160;Smazat</button>
                {{/if}}
                <div class="clearfix"></div>
              </div>
              <div class="panel-body">
              <div class="col-md-12">
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Switch:</strong></p></div>
                  <div class="col-sm-10"><a href="#" {{action 'openTabs' (concat 'http://' model.dhcp.switch.name) (concat 'https://' model.dhcp.switch.name)}}>{{model.dhcp.switch.name}}</a></div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Master:</strong></p></div>
                  <div class="col-sm-10">{{model.dhcp.master}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Port:</strong></p></div>
                  <div class="col-sm-10">{{model.dhcp.port}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>IP:</strong></p></div>
                  <div class="col-sm-10">{{model.dhcp.ip}}</div>
                </div>
              </div>
              </div>
            </div>
          </div>
        {{/if}}
        {{#if model.pppoe.service_id}}
          <div class="col-md-6">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title pull-left">PPPoE</h3>
                {{#if canEditPppoe}}
                  <button class="btn btn-primary pull-right" {{action 'openModal' 'formEditPppoe' model}}><span class="glyphicon glyphicon-edit"></span>&#160;Upravit</button>
                  <button class="btn btn-danger pull-right btn-delete" {{action 'openModal' 'confirmPppoeRemoval' model}}><span class="glyphicon glyphicon-trash"></span>&#160;Smazat</button>
                {{/if}}
                <div class="clearfix"></div>
              </div>
              <div class="panel-body">
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Master:</strong></p></div>
                  <div class="col-sm-10">{{model.pppoe.master}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Area:</strong></p></div>
                  <div class="col-sm-10">{{model.pppoe.area}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Interface:</strong></p></div>
                  <div class="col-sm-10">{{model.pppoe.interface}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Location:</strong></p></div>
                  <div class="col-sm-10">{{model.pppoe.location}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>IP:</strong></p></div>
                  <div class="col-sm-10">
                    {{#if isPppoeStaticIp}}
                      {{model.pppoe.ip.value}}
                    {{else}}
                      {{model.pppoe.ip_class}}
                    {{/if}}
                    {{#if isPppoeOnline}}
                      <i class="glyphicon glyphicon-cloud" style="color:green"></i>
                    {{else}}
                      <i class="glyphicon glyphicon-cloud" style="color:gray"></i>
                    {{/if}}
                    {{#if lastPppoeIp}}<br/>
                      <small>poslední IP:
                      <a href="#" {{action 'openTabs' (concat 'http://' lastPppoeIp ':65535') (concat 'http://' lastPppoeIp)}}>{{lastPppoeIp}}</a>
                      <span class="glyphicon glyphicon-new-window"></span>
                      {{#if lastPppoeIpDate}}, {{lastPppoeIpDate}}{{/if}}
                      </small>
                    {{/if}}
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>MAC:</strong></p></div>
                  <div class="col-sm-10">{{uppercase model.pppoe.mac.value}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Login:</strong></p></div>
                  <div class="col-sm-10">{{model.pppoe.login}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Heslo:</strong></p></div>
                  <div class="col-sm-10">{{model.pppoe.password}}</div>
                </div>
              </div>
            </div>
          </div>
        {{/if}}
        {{#if model.comments}}
          <div class="col-md-6">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title pull-left">Komentáře</h3>
                <div class="clearfix"></div>
              </div>
              <div class="panel-body">
                {{#each model.comments as |comment|}}
                  <div class="row">
                    <div class="col-sm-1">{{comment.user}}</div>
                    <div class="col-sm-3">{{stamp comment.date}}</div>
                    <div class="col-sm-8">{{comment.comment}}</div>
                  </div>
                {{/each}}
              </div>
            </div>
          </div>
        {{/if}}
      </div>
      {{#link-to 'services'}}Zpět{{/link-to}}
    </script>

    <script type="text/x-handlebars" data-template-name="formEditService">
      {{#modal-form title='Upravit' ok='submit' close='closeModal'}}
        <h4>{{model.form.service.id}} {{model.form.service.name}} {{model.service.download}}/{{model.service.upload}} Mbs</h4>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>Status:</label>
            {{view "select"
               class="form-control"
               content=statuses
               optionValuePath="content.value"
               optionLabelPath="content.name"
               value=model.form.service.status}}
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 form-group">
            <label>Zařízení:</label>
              {{#each model.form.service.data.devices as |device index|}}
                <div class="form-group">
                  <div class="pull-left">
                    {{input value=device.name class="form-control"}}
                  </div>&nbsp;
                  {{radio-button name=(concat 'owner_'index) groupValue=device.owner value="silesnet"}} SilesNet
                  {{radio-button name=(concat 'owner_' index) groupValue=device.owner value="customer"}} Zákazník
                  <button type="button" class="btn btn-danger btn-sm" {{action 'removeDevice' device}}><span class="glyphicon glyphicon-trash"></span>&#160;Smazat</button>
                </div>
              {{/each}}
            <button type="button" class="btn btn-primary btn-sm" {{action 'addDevice'}}><span class="glyphicon glyphicon-plus"></span>&#160;Přidat</button>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 form-group">
            <label>Poznámky:</label>
            {{textarea class="form-control" value=model.form.service.info rows="5"}}
          </div>
        </div>
      {{/modal-form}}
    </script>

    <script type="text/x-handlebars" data-template-name="formEditSms">
      {{#modal-form title='Poslat SMS' ok='submit' close='closeModal' submitLabel='Poslat'}}
        <h4>{{model.customer.name}}</h4>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>Číslo:</label>
            {{input class="form-control" value=phoneNumber}}
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 form-group">
            <label>Zpráva:</label>
            {{textarea class="form-control autofocus" value=smsMessage  key-down='smsKeysInputFilter' maxlength=160 rows=2}}
          </div>
        </div>
      {{/modal-form}}
    </script>

    <script type="text/x-handlebars" data-template-name="formAddTodo">
      {{#modal-form title='Add TODO' ok='submit' close='closeModal'}}
        <h4>{{model.customer.name}}, {{model.service.id}} {{model.service.name}} {{model.service.download}}/{{model.service.upload}} Mbs</h4>
        {{#if model.service.address}}
          <p>{{address model.service.address}}</p>
        {{/if}}
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>Category:</label>
            {{view "select"
               class="form-control"
               content=categories
               value=category}}
          </div>
          <div class="col-sm-6 form-group">
            <label>Priority:</label>
            {{view "select"
               class="form-control"
               content=priorities
               value=priority}}
          </div>
          <div class="col-sm-6 form-group">
            <label>Operator:</label>
            {{view "select"
               class="form-control"
               content=users
               optionValuePath="content.name"
               optionLabelPath="content.name"
               value=assignee}}
          </div>
          <div class="col-sm-12 form-group">
            <label>Comment:</label>
            {{textarea class="form-control autofocus" value=comment rows='5'}}
          </div>
        </div>
      {{/modal-form}}
    </script>

    <script type="text/x-handlebars" data-template-name="formEditDhcp">
      {{#modal-form title='Upravit' ok='submit' close='closeModal'}}
        <p>DHCP pro {{model.form.service.id}} {{model.form.service.name}}</p>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>Switch:</label>
            {{view "select"
               class="form-control"
               content=switches
               optionValuePath="content.id"
               optionLabelPath="content.name"
               value=model.form.dhcp.network_id}}
          </div>
          <div class="col-sm-6 form-group">
            <label>Port:</label>
            {{view App.PortField value=model.form.dhcp.port}}
          </div>
        </div>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>IP:</label>
            {{view App.IPAddressField value=model.form.dhcp.ip placeholder="AUTO"}}
          </div>
        </div>
      {{/modal-form}}
    </script>

    <script type="text/x-handlebars" data-template-name="formEditPppoe">
      {{#modal-form title='Upravit' ok='submit' close='closeModal'}}
        <p>PPPoE pro {{model.form.service.id}} {{model.form.service.name}}</p>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>Master:</label>
            {{view "select"
               class="form-control"
               content=routers
               optionValuePath="content.name"
               optionLabelPath="content.name"
               value=model.form.pppoe.master
               disabled=isWireless}}
          </div>
          {{#if isWireless}}
            <div class="col-sm-6 form-group">
              <label>SSID:</label>
              {{view "select"
                 class="form-control"
                 content=ssids
                 optionValuePath="content"
                 optionLabelPath="content.ssid"
                 value=ssid}}
            </div>
          {{/if}}
        </div>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>Location:</label>
            {{input class="form-control" value=model.form.pppoe.location type=text}}
          </div>
          <div class="col-sm-6 form-group">
            {{#if isWireless}}
              <label>Interface:</label>
              {{input class="form-control" name="interface" value=model.form.pppoe.interface type=text disabled=true}}
            {{/if}}
          </div>
        </div>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>IP class:</label>
            {{view "select"
               class="form-control"
               content=ipClasses
               value=model.form.pppoe.ip_class}}
          </div>
          <div class="col-sm-6 form-group">
            <label>IP:</label>
            {{view App.IPAddressField
              value=model.form.pppoe.ip.value placeholder="127.0.0.1"
              disabled=isNotStaticIp}}
            </div>
        </div>
        <div class="row">
          {{#if isWireless}}
            <div class="col-sm-6 form-group">
              <label>MAC:</label>
              {{view App.MACAddressField value=model.form.pppoe.mac.value}}
            </div>
          {{/if}}
        </div>        <div class="row">
          <div class="col-sm-6 form-group">
            <label>Login:</label>
            {{input disabled=true class="form-control" name="login" value=model.form.pppoe.login type=text}}
          </div>
          <div class="col-sm-6 form-group">
            <label>Password:</label>
            {{input disabled=true class="form-control" value=model.form.pppoe.password type=text}}
          </div>
        </div>
      {{/modal-form}}
    </script>


    <script type="text/x-handlebars" data-template-name="confirmDhcpRemoval">
      {{#modal-form title='Odebrat DHCP' ok='removeDhcp' close='closeModal' submitLabel='Odebrat'}}
        <p>Chcete opravdu odebrat DHCP pro {{model.service.id}} {{model.service.name}}?</p>
      {{/modal-form}}
    </script>

    <script type="text/x-handlebars" data-template-name="confirmPppoeRemoval">
      {{#modal-form title='Odebrat PPPoE' ok='removePppoe' close='closeModal' submitLabel='Odebrat'}}
        <p>Chcete opravdu odebrat PPPoE pro {{model.service.id}} {{model.service.name}}?</p>
      {{/modal-form}}
    </script>

    <script type="text/x-handlebars" data-template-name="changelog">
      <h2>Seznam posledních změn aplikace</h2>
      <table class="table">
      <tbody>
      {{#each model key="id" as |ticket|}}
        <tr>
          <td>{{date ticket.closed_at}}</td>
          <td class="issue-closed"><a href="{{ticket.html_url}}" target="_blank"><b>{{ticket.title}}</b></a></td>
        </tr>
      {{/each}}
      </tbody>
      </table>
    </script>

    <script type="text/x-handlebars" data-template-name="service-errors">
      <h2>Seznam služeb s DHCP i PPPoE autentifikací</h2>
      <table class="table">
      <tbody>
      {{#each model.conflicts as |service|}}
        <tr>
          <td>{{#link-to 'service' service.id}}{{service.id}}{{/link-to}}</td>
          <td>{{service.name}}</td>
          <td>{{service.download}}/{{service.upload}} Mbs</td>
        </tr>
      {{/each}}
      </tbody>
      </table>
    </script>

    <script type="text/x-handlebars" data-template-name="components/modal-form">
      <div class="modal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title">{{title}}</h4>
            </div>
            <div class="modal-body">
              {{yield}}
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-link" data-dismiss="modal">{{cancelLabel}}</button>
              <button type="button" class="btn btn-primary" {{action 'ok'}}>{{submitLabel}}</button>
            </div>
          </div>
        </div>
      </div>
    </script>

    <script type="text/x-handlebars" data-template-name="components/flash-message">
      {{#if hasBlock}}
        {{yield}}
      {{else}}
        {{flash.message}}
      {{/if}}
    </script>

    <script type="text/javascript" language="JavaScript" src="js/jquery.min.js"></script>
    <script type="text/javascript" language="JavaScript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" language="JavaScript" src="js/jquery-ui-datepicker-cs.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/bootstrap.min.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/ember.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/ember-template-compiler.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/app.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/app-services.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/app-components.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/app-util.js"></script>
  </body>
</html>
