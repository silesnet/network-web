<!DOCTYPE html>
<html>
  <head>
    <title>SilesNet IS</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="css/app.css">
  </head>
  <body>
    <div id='app'></div>

    <script type="text/x-handlebars">
      <nav class="navbar navbar-default" role="navigation">
        <div class="container">
          <a class="navbar-brand" href="..">Home</a>
          <a class="navbar-brand" href="#/services">Služby</a>
          <a class="navbar-brand" href="http://localhost:9090">Přidej službu</a>
          <a class="navbar-brand" href="#/changelog"><span class="small">Sezam změn</span></a>
          <div class="navbar-right navbar-brand">
            <span class='glyphicon glyphicon-user'></span>
            {{model.user.name}}|{{model.user.operation_country}}
          </div>
        </div>
      </nav>
      <div class="content">
        <div class="container">
          {{outlet}}
          {{outlet 'modal'}}
          <div class="notifications top-right">
          {{#each flashes.queue as |flash|}}
            {{#flash-message flash=flash}}
              <p>{{flash.message}}</p>
            {{/flash-message}}
          {{/each}}
          </div>
        </div>
      </div>
    </script>

    <script type="text/x-handlebars" id="services">
      <div class="input-group">
        <span class="input-group-addon" title="Aktivní zákazníci">
            {{active-button name="isActive" value=model.isActive}}
        </span>
        {{input id="service_search" class="form-control" type="text" value=model.query placeholder="Customer or Agreement" autofocus="true"}}
        <div class="input-group-btn">
          <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
        </div>
      </div>
      {{#if model.services}}
        <table class="table table-striped">
          <tbody>
          {{#each model.services as |service|}}
            <tr {{action 'editService' service}} class="clickable">
              <td>{{service.service_id}}</td>
              <td>{{service.customer_name}}</td>
              <td>{{service.service_name}}</td>
              <td>{{service.download}}/{{service.upload}} Mbps</td>
              <td>{{service.agreement}}</td>
              <td>{{service.street}}</td>
              <td>{{service.city}}</td>
              <!--<td>{{service.customer_info}}</td>-->
              <td>{{service.service_info}}</td>
              <!--<td>{{#link-to 'service' service.service_id}}Upravit{{/link-to}}</td>-->
            </tr>
          {{/each}}
          </tbody>
        </table>
      {{/if}}
    </script>

    <script type="text/x-handlebars" id="service">
      <h2>{{model.customer.name}}
        {{#unless model.dhcp.port}}
          <div class="btn-group pull-right service"><button class="btn btn-success" {{action 'openModal' 'formEditDhcp' model}}><span class="glyphicon glyphicon-plus"></span>&#160;DHCP</button></div>
        {{/unless}}
        {{#unless model.pppoe.service_id}}
          <div class="btn-group pull-right service"><button class="btn btn-success" {{action 'openModal' 'formEditPppoe' model}}><span class="glyphicon glyphicon-plus"></span>&#160;PPPoE</button></div>
        {{/unless}}
        <br />
        <span class="small">
          {{model.customer.street}}, {{model.customer.postal_code}} {{model.customer.city}}
          <a href="http://www.google.com/maps?q={{model.customer.street}}, {{model.customer.city}}&t=k" target="_blank"><i class="glyphicon glyphicon-map-marker"></i></a>
          &nbsp;{{model.customer.email}}
          <a href="mailto:{{model.customer.email}}"><i class="glyphicon glyphicon-envelope"></i></a>
          &nbsp;{{model.customer.phone}}
          <a href="#" {{action 'openModal' 'formEditSms' model}}><i class="glyphicon glyphicon-phone"></i></a>
        </span>
      </h2>
      <h3>{{model.service.id}} {{model.service.name}} {{model.service.download}}/{{model.service.upload}} Mbs</h3>

      {{#if model.service.address}}
        <p>{{address model.service.address}}</p>
      {{/if}}

      <div class="row">
        <div class="col-md-6">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title pull-left">Detail</h3>
              <button class="btn btn-primary pull-right" {{action 'openModal' 'formEditService' model}}><span class="glyphicon glyphicon-edit"></span>&#160;Upravit</button>
              <div class="clearfix"></div>
            </div>
            <div class="panel-body">
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Stav:</strong></p></div>
                  <div class="col-sm-10">{{serviceStatus}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Poznámky:</strong></p></div>
                  <div class="col-sm-10">{{model.service.info}}</div>
                </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        {{#if model.dhcp.port}}
          <div class="col-md-6">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title pull-left">DHCP</h3>
                <button class="btn btn-primary pull-right" {{action 'openModal' 'formEditDhcp' model}}><span class="glyphicon glyphicon-edit"></span>&#160;Upravit</button>
                <button class="btn btn-danger pull-right btn-delete" {{action 'openModal' 'confirmDhcpRemoval' model}}><span class="glyphicon glyphicon-trash"></span>&#160;Smazat</button>
                <div class="clearfix"></div>
              </div>
              <div class="panel-body">
              <div class="col-md-12">
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Switch:</strong></p></div>
                  <div class="col-sm-10"><a href="#" {{action 'openTabs' (concat 'http://' model.dhcp.switch.name) (concat 'https://' model.dhcp.switch.name)}}>{{model.dhcp.switch.name}}</a></div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Master:</strong></p></div>
                  <div class="col-sm-10">{{model.dhcp.master}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Port:</strong></p></div>
                  <div class="col-sm-10">{{model.dhcp.port}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>IP:</strong></p></div>
                  <div class="col-sm-10">{{model.dhcp.ip}}</div>
                </div>
              </div>
              </div>
            </div>
          </div>
        {{/if}}
        {{#if model.pppoe.service_id}}
          <div class="col-md-6">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title pull-left">PPPoE</h3>
                <button class="btn btn-primary pull-right" {{action 'openModal' 'formEditPppoe' model}}><span class="glyphicon glyphicon-edit"></span>&#160;Upravit</button>
                <button class="btn btn-danger pull-right btn-delete" {{action 'openModal' 'confirmPppoeRemoval' model}}><span class="glyphicon glyphicon-trash"></span>&#160;Smazat</button>
                <div class="clearfix"></div>
              </div>
              <div class="panel-body">
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Master:</strong></p></div>
                  <div class="col-sm-10">{{model.pppoe.master}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Interface:</strong></p></div>
                  <div class="col-sm-10">{{model.pppoe.interface}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Location:</strong></p></div>
                  <div class="col-sm-10">{{model.pppoe.location}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>IP:</strong></p></div>
                  <div class="col-sm-10">
                    {{#if isPppoeStaticIp}}
                      {{model.pppoe.ip.value}}
                    {{else}}
                      {{model.pppoe.ip_class}}
                    {{/if}}
                    {{#if lastPppoeIp}} 
                      &nbsp;(poslední IP:
                      <a href="#" {{action 'openTabs' (concat 'http://' lastPppoeIp ':65535') (concat 'http://' lastPppoeIp)}}>{{lastPppoeIp}}</a>
                      <span class="glyphicon glyphicon-new-window"></span>)
                    {{/if}}
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>MAC:</strong></p></div>
                  <div class="col-sm-10">{{uppercase model.pppoe.mac.value}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Login:</strong></p></div>
                  <div class="col-sm-10">{{model.pppoe.login}}</div>
                </div>
                <div class="row">
                  <div class="col-sm-2"><p class="text-right"><strong>Heslo:</strong></p></div>
                  <div class="col-sm-10">{{model.pppoe.password}}</div>
                </div>
              </div>
            </div>
          </div>
        {{/if}}
      </div>
      {{#link-to 'services'}}Zpět{{/link-to}}
    </script>

    <script type="text/x-handlebars" data-template-name="formEditService">
      {{#modal-form title='Upravit' ok='submit' close='closeModal'}}
        <h4>{{model.form.service.id}} {{model.form.service.name}} {{model.service.download}}/{{model.service.upload}} Mbs</h4>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>Status:</label>
            {{view "select"
               class="form-control"
               content=statuses
               optionValuePath="content.value"
               optionLabelPath="content.name"
               value=model.form.service.status}}
          </div>
        </div>        
        <div class="row">
          <div class="col-sm-12 form-group">
            <label>Poznámky:</label>
            {{textarea class="form-control" value=model.form.service.info rows="5"}}
          </div>
        </div>        
      {{/modal-form}}
    </script>

    <script type="text/x-handlebars" data-template-name="formEditSms">
      {{#modal-form title='Poslat SMS' ok='submit' close='closeModal'}}
        <h4>{{model.customer.name}} {{model.customer.phone}}</h4>
        <div class="row">
          <div class="col-sm-12 form-group">
            <label>Zpráva:</label>
            {{input class="form-control" value=smsMessage autofocus="true"}}
          </div>
        </div>        
      {{/modal-form}}
    </script>

    <script type="text/x-handlebars" data-template-name="formEditDhcp">
      {{#modal-form title='Upravit' ok='submit' close='closeModal'}}
        <p>DHCP pro {{model.form.service.id}} {{model.form.service.name}}</p>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>Switch:</label>
            {{view "select"
               class="form-control"
               content=switches
               optionValuePath="content.id"
               optionLabelPath="content.name"
               value=model.form.dhcp.network_id}}
          </div>
          <div class="col-sm-6 form-group">
            <label>Port:</label>
            {{view App.PortField value=model.form.dhcp.port}}
          </div>
        </div>        
        <div class="row">
          <div class="col-sm-6 form-group">   
            <label>IP:</label>
            {{view App.IPAddressField value=model.form.dhcp.ip placeholder="AUTO"}}
          </div>
        </div>
      {{/modal-form}}
    </script>

    <script type="text/x-handlebars" data-template-name="formEditPppoe">
      {{#modal-form title='Upravit' ok='submit' close='closeModal'}}
        <p>PPPoE pro {{model.form.service.id}} {{model.form.service.name}}</p>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>Master:</label>
            {{view "select"
               class="form-control"
               content=routers
               optionValuePath="content.name"
               optionLabelPath="content.name"
               value=model.form.pppoe.master}}
          </div>
          {{#if isWireless}}
            <div class="col-sm-6 form-group">   
              <label>Interface:</label>
              {{input class="form-control" name="interface" value=model.form.pppoe.interface type=text}}
            </div>
          {{/if}}  
        </div>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>Location:</label>
            {{input class="form-control" value=model.form.pppoe.location type=text}}
          </div>
          <div class="col-sm-6 form-group">
            <label></label>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-6 form-group">
            <label>IP class:</label>
            {{view "select"
               class="form-control"
               content=ipClasses
               value=model.form.pppoe.ip_class}}
          </div>
          <div class="col-sm-6 form-group">
            <label>IP:</label>
            {{view App.IPAddressField
              value=model.form.pppoe.ip.value placeholder="127.0.0.1"
              disabled=isNotStaticIp}}
            </div>
        </div>
        <div class="row">
          {{#if isWireless}}
            <div class="col-sm-6 form-group">
              <label>MAC:</label>
              {{view App.MACAddressField value=model.form.pppoe.mac.value}}
            </div>
          {{/if}}  
        </div>        <div class="row">  
          <div class="col-sm-6 form-group">   
            <label>Login:</label>
            {{input class="form-control" name="login" value=model.form.pppoe.login type=text}}
          </div>
          <div class="col-sm-6 form-group">
            <label>Password:</label>
            {{input class="form-control" value=model.form.pppoe.password type=text}}
          </div>
        </div>
      {{/modal-form}}
    </script>


    <script type="text/x-handlebars" data-template-name="confirmDhcpRemoval">
      {{#modal-form title='Odebrat DHCP' ok='removeDhcp' close='closeModal'}}
        <p>Chcete opravdu odebrat DHCP pro {{model.service.id}} {{model.service.name}}?</p>
      {{/modal-form}}
    </script>

    <script type="text/x-handlebars" data-template-name="confirmPppoeRemoval">
      {{#modal-form title='Odebrat PPPoE' ok='removePppoe' close='closeModal'}}
        <p>Chcete opravdu odebrat PPPoE pro {{model.service.id}} {{model.service.name}}?</p>
      {{/modal-form}}
    </script>

    <script type="text/x-handlebars" data-template-name="changelog">
      <h2>Seznam posledních změn aplikace</h2>
      <table class="table">
      <tbody>
      {{#each model key="id" as |ticket|}}
        <tr>
          <td>{{date ticket.closed_at}}</td>
          <td class="issue-closed"><a href="{{ticket.html_url}}" target="_blank"><b>{{ticket.title}}</b></a></td>
        </tr>
      {{/each}}
      </tbody>
      </table>
    </script>

    <script type="text/x-handlebars" data-template-name="components/modal-form">
      <div class="modal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title">{{title}}</h4>
            </div>
            <div class="modal-body">
              {{yield}}
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Storno</button>
              <button type="button" class="btn btn-primary" {{action 'ok'}}>Uložit</button>
            </div>
          </div>
        </div>
      </div>
    </script>

    <script type="text/x-handlebars" data-template-name="components/flash-message">
      {{#if hasBlock}}
        {{yield}}
      {{else}}
        {{flash.message}}
      {{/if}}
    </script>
  
    <script type="text/javascript" language="JavaScript" src="js/jquery.min.js"></script>
    <script type="text/javascript" language="JavaScript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" language="JavaScript" src="js/jquery-ui-datepicker-cs.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/bootstrap.min.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/ember.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/ember-template-compiler.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/app.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/app-services.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/app-components.js"></script>
    <script type="text/JavaScript" language="JavaScript" src="js/app-util.js"></script>
  </body>
</html>
